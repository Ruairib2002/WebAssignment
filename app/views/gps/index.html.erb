<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GPS Map</title>

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Import map should be loaded before any JavaScript -->
  <%= javascript_importmap_tags %>

  <!-- Include stylesheets -->
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

  <!-- Load Google Maps API asynchronously -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWzmLk5ro9tUy_AjHdyoo3p8TYuE2R4QM&callback=initMap" async defer></script>
</head>

<body>
  <div class="flash-messages">
    <% if notice %>
    <div class="alert alert-success">
      <%= notice %>
    </div>
    <% end %>
    <% if alert %>
    <div class="alert alert-danger">
      <%= alert %>
    </div>
    <% end %>
  </div>

  <!-- Render the sidebar if it exists -->
  <%= render 'layouts/sidebar' %>

  <main class="container mx-auto mt-28 px-5 flex">
    <!-- Main content will be injected here -->
    <h1>GPS Map</h1>

    <!-- Map container where the Google Map will be rendered -->
    <div id="map" data-controller="gps" data-gps-lat-value="<%= @lat %>" data-gps-lng-value="<%= @lng %>" data-gps-radius-value="<%= @radius %>" data-gps-businesses-value="<%= @businesses.to_json %>" data-gps-people-value="<%= @people.to_json %>" data-gps-items-value="<%= @items.to_json %>" style="height: 500px; width: 100%;">
    </div>

    <!-- Container for the legend -->
    <div id="legend" style="position: absolute; bottom: 10px; right: 10px; background-color: white; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>
  </main>

  <%= link_to 'View All Issues', issues_path, class: 'btn btn-primary' %>

  <!-- Stimulus.js and GPS controller -->
  <script src="https://unpkg.com/@hotwired/stimulus@3.0.0/dist/stimulus.js"></script>
  <script src="https://unpkg.com/@hotwired/stimulus-loading@1.0.0/dist/stimulus-loading.js"></script>
</body>

</html>