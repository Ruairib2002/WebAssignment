<!DOCTYPE html>
<html>

<head>
  <title>Issues/Problem Map</title>
  <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=AIzaSyCmHtKK6Khdr2koqAakd0JrpNcYQJCJBpA&libraries=places" %>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
</head>

<body>
  <h1>Report Road Issues</h1>

  <!-- Button to redirect user to the new issue form -->
  <button onclick="goToNewIssueForm()">Create New Issue</button>

  <!-- Map container -->
  <div id="map"></div>

  <script>
    let map;
    let marker;
    let issueLatitude;
    let issueLongitude;
    const markerExpirationTime = 60 * 1000;

    function initMap() {
      // Map initialization with a default center
      const mapOptions = {
        center: {
          lat: 54.4231, // Set your default latitude here
          lng: -6.4446 // Set your default longitude here
        },
        zoom: 12
      };

      map = new google.maps.Map(document.getElementById('map'), mapOptions);

      map.addListener('click', function(event) {
        // Remove any existing marker
        if (marker) {
          marker.setMap(null);
        }

        // Place a new marker where the user clicked
        marker = new google.maps.Marker({
          position: event.latLng,
          map: map,
          draggable: true
        });

        // Update the latitude and longitude values
        issueLatitude = event.latLng.lat();
        issueLongitude = event.latLng.lng();
      });
    }

    // Function to redirect to the form page with latitude and longitude as parameters
    function goToNewIssueForm() {
      if (issueLatitude && issueLongitude) {
        window.location.href = "<%= new_issue_path %>?latitude=" + issueLatitude + "&longitude=" + issueLongitude;
      } else {
        alert("Please click on the map to place the marker first.");
      }
    }

    google.maps.event.addDomListener(window, 'load', initMap);
  </script>
</body>

</html>